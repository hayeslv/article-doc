# 深入理解http2.0协议

## 简介

HTTP2.0大幅度的提高了web性能，在HTTP1.1完全语义兼容的基础上，进一步减少了网络的延迟。实现低延迟高吞吐量。

对于前端开发者而言，减少了优化工作。

- 二进制分帧
- 首部压缩
- 流量控制
- 多路复用
- 请求优先级
- 服务器推送



## 二进制分帧

在不改变HTTP1.x的语义、方法、状态码、URL以及首部字段的情况下，HTTP2.0是怎样突破HTTP1.1的性能限制，改进传输性能，实现低延迟高吞吐量的呢？关键之一就是在应用层（HTTP）和传输层（TCP）之间增加了一个二进制分帧层。

关于帧的知识：

- 帧：HTTP2.0通信的最小单位，所有帧都共享一个8字节的首部，其中包含帧的长度、类型、标志、还有一个保留位，并且至少有标识出当前帧所属的流的标识符，帧承载着特定类型的数据，如HTTP首部、负荷等等。
- 消息：比帧大的通讯单位，是指逻辑上的HTTP消息，比如请求、响应等。由一个或多个帧组成。
- 流：比消息大的通讯单位。是TCP连接中的一个虚拟通道，可以承载双向的消息。每个流都有一个唯一的整数标识符。



### 1、什么是二进制分帧

在二进制分帧上，HTTP2.0会将所有传输信息分割为更小的消息和帧，并对它们采用二进制格式的编码将其封装。其中，HTTP1.x中的首部信息header封装到Headers帧中，而 request body 将被封装到Data帧中。



### 2、二进制分帧如何工作

HTT2.0通信都在一个TCP连接上完成，这个连接可以承载任意数量的双向数据流，相应的每个数据流以消息的形式发送。而消息由一或多个帧组成，这些帧可以乱序发送，然后根据每个帧首部的流标识符重新组装。



### 3、二进制分帧对性能优化工作的贡献

**二进制分帧**主要是为下文中的各种特性提供了性能。它能把一个数据划分为更小更便捷的数据。首先是在单链接多资源方式中，减少了服务端的链接压力，内存占用更少，链接吞吐量更大。这一点可以结合下文中的**多路复用**来体会。另一方面，由于TCP链接的减少而使网络拥塞状态得以改善，同时慢启动时间的减少。使拥塞和丢包恢复的速度更快。



## 首部压缩

HTTP1.1并不支持HTTP首部压缩，为此SPDY和HTTP2.0出现了。SPDY用的是DEFLATE算法，而 `HTTP2.0` 则使用了专门为首部压缩设计的 `HPACK` 算法



### 1、什么是首部压缩

HTTP1.x 每次通讯（请求或响应）都会携带首部信息用于描述资源属性。而 HTTP2.0在客户端和服务端之间使用首部表来跟踪和存储之前发送的键值对。请求与响应首部的定义在 HTTP2.0 中基本没变，知识所有首部键必须全部小写，而且要求行要独立为 `:method:`、`:scheme:`、`:host:`、`:path:` 这些键值对



https://juejin.cn/post/6844903545532071943

https://zhuanlan.zhihu.com/p/89471776

https://zhuanlan.zhihu.com/p/39053130





















































